import java.io.*;
import javax.xml.parsers.*;
import org.xml.sax.*;
import org.xml.sax.helpers.*;
import java.util.*;
import java.text.*;

public class transxchange2GoogleTransit {

	/**
	 * transxchange2GoogleTransit <transxchange xml filename>
	 */
	public static void main(String[] args)
    throws SAXException,IOException, ParserConfigurationException
    {
        // Create a parser factory and use it to create a parser
        SAXParserFactory parserFactory = SAXParserFactory.newInstance();
        SAXParser parser = parserFactory.newSAXParser();
 
        // This is the name of the file you're parsing
        if (args.length != 1) {
        	System.out.println("Usage: transxchange2GoogleTransit <transxchange xml filename>");
        	System.exit(0);
        }
        String filename = args[0];
 
        // Instantiate a DefaultHandler subclass to do parse the input file and output Google Transit data feed
        transxchangeHandler handler = new transxchangeHandler();

        // Start the parser. It reads the file and calls methods of the handler
        parser.parse(new File(filename), handler);

    }

    // This inner class extends DefaultHandler to parse an transxchange xml file
	// and generate corresponding Google Transit data feed files
    public static class transxchangeHandler extends DefaultHandler {
 
    	/**
    	 * Hardcoded xml keys and output field fillers. 
    	 * 	Better practice: configuration file
    	 */
    	
    	// Google Transit file names
    	static final String agencyFilename = "agency.txt";
    	static final String stopFilename = "stops.txt";
       	static final String routesFilename = "routes.txt";
       	static final String tripsFilename = "trips.txt";
       	static final String stop_timesFilename = "stop_times.txt";
       	static final String calendarFilename = "calendar.txt";
       	static final String calendar_datesFilename = "calendar_dates.txt";
       	
       	// Google Transit field names and corrsponding transxchange xml keys, default values
      	static final String[] key_agency__agency_name = new String[] {"OperatorShortName", "OpenRequired"}; // Google Transit required
      	static final String[] key_agency__agency_url = new String[] {"EmailAddress", "OpenRequired"}; // Google Transit required
      	static final String[] key_agency__agency_timezone = new String[] {"__transxchange2GoogleTransit_drawDefault", "Europe/London"}; // Google Transit required
      	static final String[] key_stops__stop_id = new String[] {"AtcoCode", "OpenRequired"}; // Google Transit required
      	static final String[] key_stops__stop_id2 = new String[] {"StopPointRef", "OpenRequired"}; // Google Transit required
      	static final String[] key_stops__stop_name = new String[] {"CommonName", "OpenRequired"}; // Google Transit required
      	static final String[] key_stops__stop_desc = new String[] {"__transxchange2GoogleTransit_drawDefault", "n/a"};
      	static final String[] key_stops__stop_lat = new String[] {"__transxchange2GoogleTransit_drawDefault", "OpenRequired"}; // Google Transit required
     	static final String[] key_stops__stop_lon = new String[] {"__transxchange2GoogleTransit_drawDefault", "OpenRequired"}; // Google Transit required
     	static final String[] key_stops__stop_city = new String[] {"__transxchange2GoogleTransit_drawDefault", "n/a"};
     	static final String[] key_stops__stop_region = new String[] {"__transxchange2GoogleTransit_drawDefault", "n/a"};
     	static final String[] key_stops__stop_postcode = new String[] {"__transxchange2GoogleTransit_drawDefault", "n/a"};
     	static final String[] key_stops__stop_country = new String[] {"__transxchange2GoogleTransit_drawDefault", "n/a"};
     	static final String[] key_routes__route_id = new String[] {"Line id", "OpenRequired"}; // Google Transit required
      	static final String[] key_routes__route_short_name = new String[] {"LineName", "OpenRequired"}; // Google Transit required
     	static final String[] key_routes__route_long_name = new String[] {"Description", "OpenRequired"}; // Google Transit required
     	static final String[] key_routes__route_desc = new String[] {"__transxchange2GoogleTransit_drawDefault", "n/a"};
     	static final String[] key_routes__route_type = new String[] {"__transxchange2GoogleTransit_drawDefault", "3"}; // Google Transit required
      	static final String[] key_trips__route_id = new String[] {"JourneyPatternRef", "OpenRequired"}; // Google Transit required
      	static final String[] key_trips__route_id2 = new String[] {"VehiceJourneyRef", "OpenRequired"}; // Google Transit required
      	static final String[] key_trips__service_id = new String[] {"ServiceRef", "OpenRequired"}; // Google Transit required
      	static final String[] key_trips__trip_id = new String[] {"VehicleJourneyCode", "OpenRequired"}; // Google Transit required
      	static final String[] key_trips__trip_headsign = new String[] {"DestinationDisplay", "n/a"};
      	static final String[] key_trips__trip_block_id = new String[] {"__transxchange2GoogleTransit_drawDefault", "n/a"};
      	static final String[] key_stop_times__trip_id = new String[] {"__transxchange2GoogleTransit_drawDefault", "OpenRequired"}; // Google Transit required
      	static final String[] key_stop_times__arrival_time = new String[] {"__transxchange2GoogleTransit_drawDefault", "OpenRequired"}; // Google Transit required
      	static final String[] key_stop_times__departure_time = new String[] {"__transxchange2GoogleTransit_drawDefault", "OpenRequired"}; // Google Transit required
     	static final String[] key_stop_times__stop_id = new String[] {"StopPointRef", "OpenRequired"}; // Google Transit required
    	static final String[] key_stop_times__stop_sequence = new String[] {"__transxchange2GoogleTransit_drawDefault", "OpenRequired"}; // Google Transit required
      	static final String[] key_stop_times__type = new String[] {"NormalStopping", "OpenRequired"}; // Google Transit required
      	static final String[] key_calendar__service_id = new String[] {"__transxchange2GoogleTransit_drawDefault", "OpenRequired"}; // Google Transit required
      	static final String[] key_calendar__monday = new String[] {"__transxchange2GoogleTransit_drawDefault", "OpenRequired"}; // Google Transit required
      	static final String[] key_calendar__tuesday = new String[] {"__transxchange2GoogleTransit_drawDefault", "OpenRequired"}; // Google Transit required
      	static final String[] key_calendar__wednesday = new String[] {"__transxchange2GoogleTransit_drawDefault", "OpenRequired"}; // Google Transit required
      	static final String[] key_calendar__thursday = new String[] {"__transxchange2GoogleTransit_drawDefault", "OpenRequired"}; // Google Transit required
      	static final String[] key_calendar__friday = new String[] {"__transxchange2GoogleTransit_drawDefault", "OpenRequired"}; // Google Transit required
      	static final String[] key_calendar__saturday = new String[] {"__transxchange2GoogleTransit_drawDefault", "OpenRequired"}; // Google Transit required
      	static final String[] key_calendar__sunday = new String[] {"__transxchange2GoogleTransit_drawDefault", "OpenRequired"}; // Google Transit required
     	static final String[] key_calendar__start_date = new String[] {"StartDate", "OpenRequired"}; // Google Transit required
      	static final String[] key_calendar__end_date = new String[] {"EndDate", "OpenRequired"}; // Google Transit required
     	static final String[] key_calendar_dates__service_id = new String[] {"ServiceCode", "OpenRequired"}; // Google Transit required
     	static final String[] key_calendar_dates__date = new String[] {"__transxchange2GoogleTransit_drawDefault", "OpenRequired"}; // Google Transit required
     	static final String[] key_calendar_dates__exception_type = new String[] {"__transxchange2GoogleTransit_drawDefault", "OpenRequired"}; // Google Transit required
      	      	
        // Status variables: Carry status between start-element() .. characters() .. end-element() call sequences 
        String key = ""; // general key: ServiceRef, StopPointRef, VehiceJourneyRef etc.
        String niceString = ""; // hold between multiple characters() for one element 
        boolean activeStartElement = false; // Skip characters outside start/endElement

        /* Parsed data */ 
        List routes;      
        ValueList newRoute;
       
        
        
        /**
         * parse from startElement
         */   	
    	public void startElement(String uri, String name, String qName, Attributes atts) {
            if (qName.equals(key_trips__route_id[0])) 
                key = key_trips__route_id[0];

            
            if (key.length() > 0)
                activeStartElement = true;
    	}
    	
        /**
         * conclude element
         */   	
        public void endElement (String uri, String name, String qName) {

            activeStartElement = false;
 
            if (key.equals(key_trips__route_id[0])) {
                  System.out.println(niceString);
                newRoute = new ValueList(niceString);
                routes.add(newRoute);
              }

            niceString = "";

            if (qName.equals(key_trips__route_id[0])) 
                key = "";
         }

        /**
         * parse element
         */   	
        public void characters (char ch[], int start, int length) {
            if (activeStartElement) {
              for (int i = start; i < start + length; i++)
                niceString = niceString + ch[i];
            }
          }
        
        /**
         * generate Google Transit data feed files
         */   	
        public void endDocument() {
            System.out.println("endDocument");
        }
     
        
    }
    public transxchange2GoogleTransit () {
        routes = new ArrayList();
      }

}	
	
